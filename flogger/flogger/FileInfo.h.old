#pragma once

#include <filesystem>
#include <string>
#include <vector>
#include <mutex>
#include <system_error>
#include <exception>

namespace flogger {

	class FileInfo {
	public:
		explicit FileInfo(std::filesystem::path path) noexcept;

		// Accessors
		const std::filesystem::path& path() const noexcept;

		// Status checks
		bool exists() const noexcept;
		bool isWritable() const noexcept;

		// Error/exception logging (stored for later retrieval)
		void logException(const std::exception& ex, int code = 0) const noexcept;
		void logError(std::string_view message, int code = 0) const noexcept;
		std::vector<std::string> getErrors() const noexcept;
		void clearErrors() noexcept;

		// Write data to the file. Returns std::error_code == default constructed on success.
		// If overwrite == true the file is truncated, otherwise data is appended.
		std::error_code write(const std::string& data, bool overwrite = false) noexcept;

	protected:
		std::mutex& errorsMutex() const noexcept { return m_errorsMutex; }

	private:
		std::filesystem::path m_path;
		mutable std::mutex m_errorsMutex;
		mutable std::vector<std::string> m_errors;

		static std::string currentTimestamp() noexcept;
		std::string formatLoggedMessage(std::string_view base, int code) const noexcept;

		// Add friend declaration to allow StaticFunction to access private members
		friend void StaticFunction(FileInfo&);
	};

} // namespace flogger